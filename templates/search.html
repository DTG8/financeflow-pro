{% extends "base.html" %}

{% block title %}Search - FinanceFlow Pro{% endblock %}

{% block extra_styles %}
    <style>
    .search-box {
        background: var(--bg-primary);
        border: 2px solid var(--border);
        border-radius: var(--radius-lg);
        padding: 12px 20px;
        font-size: 16px;
        width: 100%;
        transition: all 0.2s;
    }
    
    .search-box:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 4px rgba(26, 115, 232, 0.1);
    }
    
    .transaction-list {
        margin-top: 24px;
    }
    
    .transaction-item {
        background: var(--bg-primary);
        border: 1px solid var(--border-light);
        border-radius: var(--radius);
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: all 0.2s;
    }
    
    .transaction-item:hover {
        box-shadow: var(--shadow-sm);
        border-color: var(--border);
    }
    
    .transaction-left {
        flex: 1;
    }
    
    .transaction-customer {
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 4px;
    }
    
    .transaction-details {
        font-size: 12px;
        color: var(--text-secondary);
    }
    
    .transaction-amount {
        font-size: 20px;
        font-weight: 700;
        color: var(--success);
        text-align: right;
    }
    
    .transaction-date {
        font-size: 11px;
        color: var(--text-tertiary);
        text-align: right;
        margin-top: 4px;
    }
    
    .badge-bank {
        display: inline-block;
        padding: 4px 8px;
        background: var(--bg-tertiary);
        border-radius: var(--radius-sm);
        font-size: 11px;
        font-weight: 600;
        color: var(--text-secondary);
        margin-top: 4px;
    }
    
    .empty-search {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
    }
    
    .empty-search i {
        font-size: 64px;
        color: var(--gray-300);
        margin-bottom: 16px;
        }
    </style>
{% endblock %}

{% block content %}
<div class="container py-4">
    
    <!-- Page Header -->
    <div class="page-header">
        <h1 class="page-title">Transaction Search</h1>
        <p class="page-subtitle">Search across all transactions and bank statements</p>
    </div>
    
    <!-- Search Box -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto">
            <div style="position: relative;">
                <input type="text" 
                       class="search-box" 
                       id="searchInput" 
                       placeholder="Search by customer name, email, reference, or description...">
                <i class="fas fa-search" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); color: var(--text-tertiary);"></i>
            </div>
        </div>
    </div>
    
    <!-- Results -->
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="transaction-list" id="resultsList"></div>
            
            <!-- Empty State -->
            <div class="empty-search" id="emptyState">
                <i class="fas fa-search"></i>
                <h5>Start Searching</h5>
                <p>Enter a customer name, email, or transaction reference to search</p>
                </div>
            </div>
        </div>

                </div>
{% endblock %}

{% block extra_scripts %}
<script>
let searchTimeout;
const searchInput = document.getElementById('searchInput');
const resultsList = document.getElementById('resultsList');
const emptyState = document.getElementById('emptyState');

searchInput.addEventListener('input', (e) => {
    clearTimeout(searchTimeout);
    const query = e.target.value.trim();
    
    if (query.length < 2) {
        resultsList.innerHTML = '';
        emptyState.style.display = 'block';
        return;
    }
    
    searchTimeout = setTimeout(() => search(query), 300);
});

function search(query) {
    fetch(`/api/search?q=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(transactions => {
            if (transactions.length === 0) {
                resultsList.innerHTML = '<div class="empty-search"><i class="fas fa-inbox"></i><h5>No Results</h5><p>No transactions found matching your search</p></div>';
                emptyState.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            resultsList.innerHTML = transactions.map(t => {
                const date = new Date(t.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                return `
                    <div class="transaction-item">
                        <div class="transaction-left">
                            <div class="transaction-customer">${t.customer_name}</div>
                            <div class="transaction-details">
                                ${t.customer_email ? `<i class="fas fa-envelope me-1"></i>${t.customer_email}` : ''}
                                ${t.reference ? `<i class="fas fa-hashtag ms-2 me-1"></i>${t.reference}` : ''}
                            </div>
                            <span class="badge-bank">${t.bank}</span>
                        </div>
                        <div>
                            <div class="transaction-amount">â‚¦${t.amount.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})}</div>
                            <div class="transaction-date">${formattedDate}</div>
                        </div>
                    </div>
                `;
            }).join('');
        });
}
</script>
{% endblock %}
